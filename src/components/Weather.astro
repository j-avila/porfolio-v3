---
import { Image } from "astro:assets"
import Cloudy from "./weather-states/Cloudy.astro"
import Sunny from "./weather-states/Sunny.astro"
import SunnyCloudy from "./weather-states/SunnyCloudy.astro"
import Rainy from "./weather-states/Rainy.astro"
import ClearNight from "./weather-states/ClearNight.astro"
import convertUnits from "convert-units"

// funcionality

const response = await fetch(import.meta.env.OPEN_WEATHER_API)
const { weather, main, name, sys } = await response.json()
const currentWeather = weather[0]
const currentDate = new Date()
const currentHour = currentDate.getHours()
const currentMinutes = currentDate.getMinutes()
---

<section
  class:list={[
    "relative flex flex-col items-center justify-center rounded-xl xs:h-auto col-span-2 row-span-1 overflow-clip p-2 lg:p-4",
    currentHour < 19 ? "weather-day" : "weather-night",
  ]}
>
  <div class="flex justify-between w-[100%]">
    {
      currentWeather.main == "Clear" ? (
        <Sunny />
      ) : currentWeather.main == "Clouds" ? (
        <Cloudy />
      ) : currentWeather.main == "Drizzle" || currentWeather.main === "Rain" ? (
        <Rainy />
      ) : (
        <Sunny />
      )
    }
    <div
      class="flex flex-col justify-start md:justify-center w-[75%] md:w-[50%]"
    >
      <h2 class="text-2xl md:text-4xl lg:text-6xl font-bold text-white">
        {`${Number(convertUnits(main.temp).from("K").to("C").toFixed(0))}Â°`}
      </h2>
      <p class="text-white text-xs md:text-base lg:text-2xl font-black">
        {`${name}, ${sys.country}`}
      </p>
      <p class="text-gray-200 text-sm md:text-base lg:text-xl">
        {currentWeather.description}
        <br />
        {`${currentHour}:${currentMinutes < 10 ? 0 : ""}${currentMinutes}`}
      </p>
    </div>
  </div>
</section>
